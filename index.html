<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Reels Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;}
@font-face{font-family:'DMSerifCustomBold';src:url('./fonts/DMSerifDisplay-Bold.ttf') format('truetype');font-weight:700;font-display:swap;}
@font-face{font-family:'PlusJakartaCustom';src:url('./fonts/PlusJakartaSans-Bold.woff2') format('woff2');font-weight:700;font-display:swap;}
body{margin:0;padding:12px;display:flex;gap:16px;background:#020617;color:#e5e7eb;font-family:'PlusJakartaCustom',sans-serif;}
.panel{background:#020617;padding:16px;border-radius:14px;border:1px solid #1f2937;box-shadow:0 16px 40px rgba(0,0,0,0.6);}
.left{width:380px;}
.right{flex:1;display:flex;justify-content:center;align-items:center;}
textarea{width:100%;min-height:60px;background:#020617;color:#fff;border:1px solid #334155;border-radius:10px;padding:10px;}
button{padding:8px 16px;border-radius:999px;border:none;cursor:pointer;}
.btn-primary{background:#2563eb;color:#fff;}
.btn-secondary{background:#111827;color:#fff;}
.status{margin-top:8px;font-size:13px;color:#9ca3af;}
.progress{margin-top:10px;width:100%;height:10px;background:#111827;border-radius:999px;overflow:hidden;}
.progress-bar{height:100%;width:0%;background:#2563eb;transition:width 0.1s;}
canvas{background:#808080;border-radius:18px;max-height:92vh;}
#downloadBtn{display:none;margin-top:10px;background:#16a34a;color:#fff;}
</style>
</head>
<body>
<div class="panel left">
<label>Upper</label>
<textarea id="upper"></textarea>
<label>Judul</label>
<textarea id="title"></textarea>
<label>Subjudul</label>
<textarea id="subtitle"></textarea>
<label>Isi</label>
<textarea id="body"></textarea>
<br>
<button id="previewBtn" class="btn-secondary">Preview</button>
<button id="renderBtn" class="btn-primary">Render WEBM</button>
<button id="downloadBtn">Download</button>
<div class="status" id="status">Status: idle</div>
<div class="progress"><div class="progress-bar" id="progressBar"></div></div>
<div class="status" id="progressText">0%</div>
</div>
<div class="panel right">
<canvas id="canvas" width="1080" height="1920"></canvas>
</div>
<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const SCALE=1.5;
canvas.width=1080*SCALE;
canvas.height=1920*SCALE;
ctx.scale(SCALE,SCALE);
const upperEl=document.getElementById('upper');
const titleEl=document.getElementById('title');
const subtitleEl=document.getElementById('subtitle');
const bodyEl=document.getElementById('body');
const previewBtn=document.getElementById('previewBtn');
const renderBtn=document.getElementById('renderBtn');
const downloadBtn=document.getElementById('downloadBtn');
const statusEl=document.getElementById('status');
const progressBar=document.getElementById('progressBar');
const progressText=document.getElementById('progressText');
let animating=false;
let animStart=null;
let targetDuration=5;
let titleCanvas;
let recordedBlob=null;
const TITLE_PRE_HOLD=0.3;
const TITLE_WIPE=0.8;
const TITLE_STATIC=2.0;
function setStatus(t){statusEl.innerText="Status: "+t;}
function setProgress(p){
const percent=Math.floor(p*100);
progressBar.style.width=percent+"%";
progressText.innerText=percent+"%";
}
function wrapText(text,maxWidth,font){
ctx.font=font;
if(!text)return[];
const words=text.split(" ");
let lines=[],line="";
for(let w of words){
let test=line+w+" ";
if(ctx.measureText(test).width>maxWidth){lines.push(line);line=w+" ";}
else line=test;
}
lines.push(line);
return lines;
}
function rebuildTitleLayout(){
titleCanvas=document.createElement("canvas");
titleCanvas.width=1080;
titleCanvas.height=1920;
const tctx=titleCanvas.getContext("2d");
tctx.fillStyle="#fff";
let y=1200;
tctx.font="700 34px PlusJakartaCustom";
wrapText(upperEl.value,830,tctx.font).forEach(l=>{tctx.fillText(l,110,y);y+=40;});
y+=60;
tctx.font="700 90px DMSerifCustomBold";
wrapText(titleEl.value,830,tctx.font).forEach(l=>{tctx.fillText(l,110,y);y+=100;});
y+=10;
tctx.font="700 34px PlusJakartaCustom";
wrapText(subtitleEl.value,830,tctx.font).forEach(l=>{tctx.fillText(l,110,y);y+=40;});
targetDuration=TITLE_PRE_HOLD+TITLE_WIPE+TITLE_STATIC+1;
}
function drawTitleScene(t){
ctx.fillStyle="#808080";
ctx.fillRect(0,0,1080,1920);
if(t<=TITLE_PRE_HOLD){ctx.drawImage(titleCanvas,0,0);return;}
const localT=t-TITLE_PRE_HOLD;
const p=Math.min(localT/TITLE_WIPE,1);
const eased=p*p*(3-2*p);
const clip=110+830*eased;
ctx.drawImage(titleCanvas,0,0);
ctx.fillStyle="#808080";
ctx.fillRect(clip,0,1080-clip,1920);
}
function drawFrame(t){
drawTitleScene(t);
}
function animate(ts){
if(!animating)return;
if(!animStart)animStart=ts;
const elapsed=(ts-animStart)/1000;
drawFrame(elapsed);
setProgress(elapsed/targetDuration);
if(elapsed<targetDuration)requestAnimationFrame(animate);
else{
animating=false;
setStatus("finished");
setProgress(1);
}}
previewBtn.onclick=()=>{
rebuildTitleLayout();
animStart=null;
animating=true;
setStatus("previewing");
requestAnimationFrame(animate);
};
renderBtn.onclick=async()=>{
rebuildTitleLayout();
setStatus("rendering");
setProgress(0);
downloadBtn.style.display="none";
const stream=canvas.captureStream(30);
const recorder=new MediaRecorder(stream,{mimeType:"video/webm"});
let chunks=[];
recorder.ondataavailable=e=>chunks.push(e.data);
recorder.onstop=()=>{
recordedBlob=new Blob(chunks,{type:"video/webm"});
downloadBtn.style.display="inline-block";
setStatus("render complete");
};
recorder.start();
animStart=null;
animating=true;
function renderLoop(ts){
if(!animStart)animStart=ts;
const elapsed=(ts-animStart)/1000;
drawFrame(elapsed);
setProgress(elapsed/targetDuration);
if(elapsed<targetDuration)requestAnimationFrame(renderLoop);
else recorder.stop();
}
requestAnimationFrame(renderLoop);
};
downloadBtn.onclick=()=>{
if(!recordedBlob)return;
const a=document.createElement("a");
a.href=URL.createObjectURL(recordedBlob);
a.download="reels.webm";
a.click();
};
window.onload=async()=>{
await document.fonts.ready;
rebuildTitleLayout();
drawFrame(0);
};
</script>
</body>
</html>
