<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Reels</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;}

@font-face{
font-family:'DMSerifCustomBold';
src:url('./fonts/DMSerifDisplay-Bold.ttf') format('truetype');
font-weight:700;
font-style:normal;
font-display:swap;
}

@font-face{
font-family:'PlusJakartaCustom';
src:url('./fonts/PlusJakartaSans-Bold.woff2') format('woff2');
font-weight:700;
font-style:normal;
font-display:swap;
}

body{
margin:0;
padding:12px;
display:flex;
gap:16px;
background:#020617;
color:#e5e7eb;
font-family:'PlusJakartaCustom',sans-serif;
}

.panel{
background:#020617;
padding:16px;
border-radius:14px;
border:1px solid #1f2937;
}

.left{
width:380px;
}

.right{
flex:1;
display:flex;
justify-content:center;
align-items:center;
}

textarea{
width:100%;
background:#020617;
color:#fff;
border:1px solid #334155;
border-radius:8px;
padding:8px;
margin-bottom:8px;
}

button{
padding:8px 14px;
border-radius:999px;
border:none;
cursor:pointer;
}

.btn-primary{
background:#2563eb;
color:white;
}

.btn-secondary{
background:#111827;
color:white;
}

.status{
font-size:12px;
margin-top:6px;
}

.progress-container{
height:6px;
background:#1f2937;
border-radius:999px;
margin-top:6px;
overflow:hidden;
}

.progress-bar{
height:100%;
width:0%;
background:#2563eb;
}

canvas{
background:#808080;
border-radius:16px;
max-height:90vh;
}
</style>
</head>

<body>

<div class="panel left">

Upper
<textarea id="upper"></textarea>

Judul
<textarea id="title"></textarea>

Subjudul
<textarea id="subtitle"></textarea>

Isi
<textarea id="body"></textarea>

<button class="btn-secondary" id="previewBtn">Preview</button>
<button class="btn-primary" id="renderBtn">Render WEBM VP8</button>

<div class="status" id="status">Status: idle</div>

<div class="progress-container">
<div class="progress-bar" id="progressBar"></div>
</div>

</div>

<div class="panel right">
<canvas id="canvas" width="1080" height="1920"></canvas>
</div>

<script>

const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

const progressBar=document.getElementById("progressBar");

const upperEl=document.getElementById("upper");
const titleEl=document.getElementById("title");
const subtitleEl=document.getElementById("subtitle");
const bodyEl=document.getElementById("body");

const previewBtn=document.getElementById("previewBtn");
const renderBtn=document.getElementById("renderBtn");

const statusEl=document.getElementById("status");

const FPS=30;

let targetDuration=10;
let bodyPages=[];
let pageDurations=[];

const TITLE_PRE_HOLD=0.3;
const TITLE_WIPE=0.8;
const TITLE_STATIC=2.0;
const PAGE_GAP=1.0;
const BODY_WIPE=0.4;

function setStatus(t){
statusEl.textContent="Status: "+t;
}

function setProgress(p){
progressBar.style.width=(p*100)+"%";
}

function wrapText(text,maxWidth,font){

ctx.font=font;

const words=text.split(" ");

let lines=[];
let line="";

for(let word of words){

let test=line+word+" ";

if(ctx.measureText(test).width>maxWidth){

lines.push(line);
line=word+" ";

}else{

line=test;

}

}

lines.push(line);

return lines;

}

function tokenizeHighlighted(text){

let tokens=[];
let parts=text.split(/(\[\[|\]\])/);

let highlight=false;

for(let p of parts){

if(p=="[["){
highlight=true;
continue;
}

if(p=="]]"){
highlight=false;
continue;
}

tokens.push({
text:p,
highlight
});

}

return tokens;

}

function rebuild(){

bodyPages=[];

let lines=bodyEl.value.split("\n");

let page=[];

for(let l of lines){

if(l.trim()==""){

if(page.length){
bodyPages.push(page);
page=[];
}

}else{

page.push(l);

}

}

if(page.length)bodyPages.push(page);

pageDurations=bodyPages.map(p=>Math.max(4,p.join(" ").split(" ").length/3));

targetDuration=
TITLE_PRE_HOLD+
TITLE_WIPE+
TITLE_STATIC+
PAGE_GAP+
pageDurations.reduce((a,b)=>a+b,0)+
PAGE_GAP*bodyPages.length;

}

function drawFrame(t){

ctx.fillStyle="#808080";
ctx.fillRect(0,0,1080,1920);

ctx.fillStyle="white";

ctx.font="700 90px DMSerifCustomBold";

ctx.fillText(titleEl.value,110,1200);

ctx.font="700 54px PlusJakartaCustom";

ctx.fillText(subtitleEl.value,110,1300);

}

previewBtn.onclick=()=>{

rebuild();

setStatus("preview");

let frame=0;

let totalFrames=Math.ceil(targetDuration*FPS);

function loop(){

let t=frame/FPS;

drawFrame(t);

setProgress(frame/totalFrames);

frame++;

if(frame<=totalFrames){

requestAnimationFrame(loop);

}else{

setStatus("idle");

}

}

loop();

};

renderBtn.onclick=async()=>{

rebuild();

setStatus("rendering");

const stream=canvas.captureStream(FPS);

const recorder=new MediaRecorder(stream,{
mimeType:"video/webm;codecs=vp8"
});

let chunks=[];

recorder.ondataavailable=e=>chunks.push(e.data);

recorder.onstop=()=>{

let blob=new Blob(chunks,{type:"video/webm"});

let a=document.createElement("a");

a.href=URL.createObjectURL(blob);
a.download="reels.webm";
a.click();

setStatus("idle");

};

recorder.start();

let frame=0;

let totalFrames=Math.ceil(targetDuration*FPS);

function renderLoop(){

let t=frame/FPS;

drawFrame(t);

setProgress(frame/totalFrames);

frame++;

if(frame<=totalFrames){

setTimeout(renderLoop,1000/FPS);

}else{

recorder.stop();

}

}

renderLoop();

};

drawFrame(0);

</script>

</body>
</html>
