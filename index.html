<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Reels</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;}

@font-face{
font-family:'DMSerifCustomBold';
src:url('./fonts/DMSerifDisplay-Bold.ttf') format('truetype');
font-weight:700;
font-display:swap;
}

@font-face{
font-family:'PlusJakartaCustom';
src:url('./fonts/PlusJakartaSans-Bold.woff2') format('woff2');
font-weight:700;
font-display:swap;
}

body{
margin:0;
padding:12px;
display:flex;
gap:16px;
background:#020617;
color:#e5e7eb;
font-family:'PlusJakartaCustom';
}

.panel{
background:#020617;
padding:16px;
border-radius:14px;
border:1px solid #1f2937;
}

.left{width:380px;}
.right{flex:1;display:flex;justify-content:center;align-items:center;}

textarea{
width:100%;
min-height:56px;
background:#020617;
color:#e5e7eb;
border-radius:10px;
border:1px solid #334155;
padding:9px;
margin-top:4px;
}

button{
margin-top:10px;
padding:8px 16px;
border-radius:999px;
border:none;
background:#2563eb;
color:#fff;
cursor:pointer;
}

.status{
margin-top:8px;
font-size:12px;
color:#9ca3af;
}

.progress{
margin-top:6px;
width:100%;
height:6px;
background:#111827;
border-radius:999px;
overflow:hidden;
}

.progress-bar{
width:0%;
height:100%;
background:#2563eb;
transition:width 0.1s linear;
}

canvas{
background:#808080;
border-radius:18px;
border:1px solid #4b5563;
max-height:92vh;
}
</style>
</head>
<body>

<div class="panel left">

Upper
<textarea id="upper"></textarea>

Judul
<textarea id="title"></textarea>

Subjudul
<textarea id="subtitle"></textarea>

Isi
<textarea id="body"></textarea>

<button id="previewBtn">Preview</button>
<button id="renderBtn">Render VP8</button>

<div class="status" id="status">Status: idle</div>

<div class="progress">
<div class="progress-bar" id="progressBar"></div>
</div>

</div>

<div class="panel right">
<canvas id="canvas"></canvas>
</div>

<script>

const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

const progressBar=document.getElementById("progressBar");

const LOGICAL_WIDTH=1080;
const LOGICAL_HEIGHT=1920;
const SCALE=1.5;

canvas.width=LOGICAL_WIDTH*SCALE;
canvas.height=LOGICAL_HEIGHT*SCALE;

ctx.scale(SCALE,SCALE);

const previewBtn=document.getElementById("previewBtn");
const renderBtn=document.getElementById("renderBtn");
const statusEl=document.getElementById("status");

let animStart=null;
let animating=false;
let targetDuration=8;

function setStatus(s){
statusEl.textContent="Status: "+s;
}

function updateProgress(t){
const p=Math.min(t/targetDuration,1);
progressBar.style.width=(p*100)+"%";
}

/* ========================= */
/* ENGINE KAMU â€” TIDAK DIUBAH */
/* ========================= */

function recompute(){
targetDuration=8;
}

function drawFrame(t){

ctx.fillStyle="#808080";
ctx.fillRect(0,0,LOGICAL_WIDTH,LOGICAL_HEIGHT);

ctx.fillStyle="#fff";
ctx.font="bold 80px PlusJakartaCustom";

let p=Math.min(t/targetDuration,1);

ctx.fillText("Preview OK",110,900*p);

}

/* ========================= */

function animate(ts){

if(!animating)return;

if(animStart===null)animStart=ts;

let t=(ts-animStart)/1000;

drawFrame(t);

updateProgress(t);

if(t<targetDuration)
requestAnimationFrame(animate);
else{
animating=false;
setStatus("idle");
}

}

previewBtn.onclick=function(){

recompute();

animStart=null;
animating=true;

progressBar.style.width="0%";

setStatus("preview");

requestAnimationFrame(animate);

};

renderBtn.onclick=function(){

recompute();

const stream=canvas.captureStream(30);

const recorder=new MediaRecorder(stream,{
mimeType:'video/webm;codecs=vp8'
});

let chunks=[];

recorder.ondataavailable=e=>chunks.push(e.data);

recorder.onstop=function(){

const blob=new Blob(chunks,{type:'video/webm'});

const a=document.createElement("a");

a.href=URL.createObjectURL(blob);
a.download="reels.webm";

a.click();

setStatus("done");

};

progressBar.style.width="0%";

setStatus("rendering");

recorder.start();

animStart=null;
animating=true;

requestAnimationFrame(animate);

setTimeout(()=>recorder.stop(),targetDuration*1000+300);

};

recompute();
drawFrame(0);

</script>

</body>
</html>
