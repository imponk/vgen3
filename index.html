<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Test Render Kosongan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body { background: #111; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
    canvas { background: #333; border: 2px solid #555; max-width: 90vw; max-height: 70vh; }
    .controls { margin-top: 20px; display: flex; gap: 10px; }
    button { padding: 15px 25px; font-size: 16px; font-weight: bold; border-radius: 10px; border: none; cursor: pointer; }
    #renderBtn { background: #2563eb; color: white; }
    #status { margin-top: 10px; color: #aaa; }
</style>
</head>
<body>

    <h2>Test Movement iPad</h2>
    <canvas id="canvas" width="1080" height="1920"></canvas>
    
    <div class="controls">
        <button id="renderBtn">Mulai Render Tes</button>
    </div>
    <div id="status">Status: Standby</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const statusEl = document.getElementById('status');
const renderBtn = document.getElementById('renderBtn');

const duration = 5; // Cukup 5 detik saja untuk tes
const fps = 30;

function drawFrame(t) {
    // Bersihkan layar
    ctx.fillStyle = '#000000';
    ctx.fillRect(0, 0, 1080, 1920);

    // Gambar Kotak Pengetesan Gerakan
    // Bergerak dari kiri (100) ke kanan (900)
    let x = 100 + (880 * (t / duration));
    
    ctx.fillStyle = '#2563eb';
    ctx.fillRect(x, 900, 150, 150);

    // Tambah teks timer sederhana
    ctx.fillStyle = 'white';
    ctx.font = 'bold 50px sans-serif';
    ctx.fillText("Detik: " + t.toFixed(2), 100, 100);
    ctx.fillText("Uji Kelancaran Gerak", 100, 170);
}

renderBtn.onclick = async () => {
    statusEl.textContent = "Status: Sedang Render...";
    renderBtn.disabled = true;

    // CaptureStream 0 (Manual) adalah yang paling aman untuk iPad
    const stream = canvas.captureStream(0);
    const recorder = new MediaRecorder(stream, {
        mimeType: 'video/webm;codecs=vp8',
        videoBitsPerSecond: 2500000
    });

    let chunks = [];
    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = () => {
        const blob = new Blob(chunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "tes-gerak-ipad.webm";
        a.click();
        
        statusEl.textContent = "Status: Selesai! Cek di Galeri/CapCut.";
        renderBtn.disabled = false;
    };

    recorder.start();
    const track = stream.getVideoTracks()[0];
    const totalFrames = duration * fps;

    for (let i = 0; i <= totalFrames; i++) {
        drawFrame(i / fps);
        track.requestFrame(); // Paksa rekam frame ini
        
        // Jeda 40ms per frame untuk memberi napas pada prosesor iPad
        await new Promise(r => setTimeout(r, 40));
    }

    setTimeout(() => recorder.stop(), 500);
};

// Tampilan awal
drawFrame(0);
</script>
</body>
</html>
