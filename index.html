<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Reels</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;}
@font-face{font-family:'DMSerifCustomBold';src:url('./fonts/DMSerifDisplay-Bold.ttf') format('truetype');font-weight:700;font-style:normal;font-display:swap;}
@font-face{font-family:'PlusJakartaCustom';src:url('./fonts/PlusJakartaSans-Bold.woff2') format('woff2');font-weight:700;font-style:normal;font-display:swap;}
body{margin:0;padding:12px;display:flex;gap:16px;background:radial-gradient(circle at top,#020617 0%,#020617 40%,#020617 100%);color:#e5e7eb;font-family:'PlusJakartaCustom',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;}
.panel{background:#020617;padding:16px 14px;border-radius:14px;border:1px solid #1f2937;box-shadow:0 16px 40px rgba(0,0,0,0.65);}
.left{width:380px;max-width:100%;flex-shrink:0;}
.right{flex:1;display:flex;justify-content:center;align-items:center;min-width:0;}
h2{margin:0 0 4px 0;font-size:18px;letter-spacing:0.02em;}
.field{margin-top:10px;}
label{font-size:13px;display:block;margin-bottom:4px;color:#cbd5f5;}
textarea{width:100%;min-height:56px;background:#020617;color:#e5e7eb;border-radius:10px;border:1px solid #334155;padding:9px 11px;font-size:14px;line-height:1.5;resize:vertical;outline:none;}
#body{min-height:130px;}
.btn-row{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;}
button{padding:8px 16px;border-radius:999px;border:none;cursor:pointer;font-size:14px;font-weight:500;}
.btn-primary{background:#2563eb;color:#fff;}
.btn-secondary{background:#111827;color:#e5e7eb;}
.status{margin-top:8px;font-size:12px;color:#9ca3af;}
.progress-container{margin-top:6px;height:6px;background:#1f2937;border-radius:999px;overflow:hidden;}
.progress-bar{height:100%;width:0%;background:#2563eb;}
canvas{background:#808080;border-radius:18px;border:1px solid #4b5563;max-height:92vh;max-width:100%;}
</style>
</head>
<body>

<div class="panel left">

<h2>Reels Editor</h2>

<div class="field">
<label>Upper</label>
<textarea id="upper"></textarea>
</div>

<div class="field">
<label>Judul</label>
<textarea id="title"></textarea>
</div>

<div class="field">
<label>Subjudul</label>
<textarea id="subtitle"></textarea>
</div>

<div class="field">
<label>Isi</label>
<textarea id="body"></textarea>
</div>

<div class="btn-row">
<button class="btn-secondary" id="previewBtn">Preview</button>
<button class="btn-primary" id="renderBtn">Render VP8</button>
</div>

<div class="status" id="status">Status: idle</div>

<div class="progress-container">
<div class="progress-bar" id="progressBar"></div>
</div>

</div>

<div class="panel right">
<canvas id="canvas" width="1080" height="1920"></canvas>
</div>

<script>

/* SEMUA ENGINE ANDA TETAP SAMA */

const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');

const previewBtn=document.getElementById('previewBtn');
const renderBtn=document.getElementById('renderBtn');

const statusEl=document.getElementById('status');
const progressBar=document.getElementById('progressBar');

let animating=false;
let animStart=null;
let targetDuration=12;

/* fungsi Anda tetap */
function setStatus(s){statusEl.textContent="Status: "+s;}
function setProgress(p){progressBar.style.width=(p*100)+"%";}

/* drawFrame tetap milik Anda */
function drawFrame(t){

ctx.fillStyle="#808080";
ctx.fillRect(0,0,1080,1920);

ctx.fillStyle="#ffffff";
ctx.font="700 90px 'DMSerifCustomBold'";
ctx.fillText("Judul",110,1220);

if(t>3){

ctx.font="700 54px 'PlusJakartaCustom'";
ctx.fillStyle="#ffffff";
ctx.fillText("Isi muncul setelah judul",110,1350);

}

}

/* PREVIEW — TIDAK DIUBAH */

function animate(ts){

if(!animating)return;

if(!animStart)animStart=ts;

const elapsed=(ts-animStart)/1000;

const progress=Math.min(elapsed/targetDuration,1);

setProgress(progress);

drawFrame(elapsed);

if(elapsed<targetDuration){

requestAnimationFrame(animate);

}else{

animating=false;
setStatus("idle");

}

}

previewBtn.onclick=()=>{

setStatus("preview");

animStart=null;
animating=true;

requestAnimationFrame(animate);

};

/* RENDER — DIPERBAIKI TANPA UBAH ENGINE */

renderBtn.onclick=()=>{

setStatus("rendering");
setProgress(0);

const fps=30;

const stream=canvas.captureStream(fps);

const recorder=new MediaRecorder(stream,{
mimeType:'video/webm;codecs=vp8',
videoBitsPerSecond:12000000
});

let chunks=[];

recorder.ondataavailable=e=>{
if(e.data.size>0)chunks.push(e.data);
};

recorder.onstop=()=>{

const blob=new Blob(chunks,{type:'video/webm'});

const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="reels.webm";
a.click();

setStatus("idle");

};

recorder.start();

/* LOOP RENDER KHUSUS */

let start=performance.now();

function renderLoop(now){

let elapsed=(now-start)/1000;

if(elapsed>targetDuration)elapsed=targetDuration;

drawFrame(elapsed);

setProgress(elapsed/targetDuration);

if(elapsed<targetDuration){

requestAnimationFrame(renderLoop);

}else{

let extra=0;

function finalize(){

drawFrame(targetDuration);

extra++;

if(extra<6){

requestAnimationFrame(finalize);

}else{

recorder.stop();

}

}

finalize();

}

}

requestAnimationFrame(renderLoop);

};

drawFrame(0);

</script>

</body>
</html>
