<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Reels</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;}

@font-face{
font-family:'DMSerifCustomBold';
src:url('./fonts/DMSerifDisplay-Bold.ttf') format('truetype');
font-weight:700;
font-display:swap;
}

@font-face{
font-family:'PlusJakartaCustom';
src:url('./fonts/PlusJakartaSans-Bold.woff2') format('woff2');
font-weight:700;
font-display:swap;
}

body{
margin:0;
padding:12px;
display:flex;
gap:16px;
background:#020617;
color:#e5e7eb;
font-family:'PlusJakartaCustom',sans-serif;
}

.panel{
background:#020617;
padding:16px;
border-radius:14px;
border:1px solid #1f2937;
}

.left{width:380px;}
.right{flex:1;display:flex;justify-content:center;align-items:center;}

textarea{
width:100%;
min-height:56px;
background:#020617;
color:#fff;
border-radius:8px;
border:1px solid #334155;
padding:8px;
margin-bottom:8px;
}

button{
padding:8px 16px;
border-radius:999px;
border:none;
cursor:pointer;
}

.btn-primary{
background:#2563eb;
color:white;
}

.btn-secondary{
background:#111827;
color:white;
}

.status{
font-size:12px;
margin-top:6px;
}

.progress-container{
height:6px;
background:#1f2937;
border-radius:999px;
margin-top:6px;
overflow:hidden;
}

.progress-bar{
height:100%;
width:0%;
background:#2563eb;
}

canvas{
background:#808080;
border-radius:16px;
max-height:92vh;
}
</style>
</head>

<body>

<div class="panel left">

Upper
<textarea id="upper"></textarea>

Judul
<textarea id="title"></textarea>

Subjudul
<textarea id="subtitle"></textarea>

Isi
<textarea id="body"></textarea>

<button class="btn-secondary" id="previewBtn">Preview</button>
<button class="btn-primary" id="renderBtn">Render WEBM VP8</button>

<div class="status" id="status">Status: idle</div>

<div class="progress-container">
<div class="progress-bar" id="progressBar"></div>
</div>

</div>

<div class="panel right">
<canvas id="canvas" width="1080" height="1920"></canvas>
</div>

<script>

const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

const progressBar=document.getElementById("progressBar");

const previewBtn=document.getElementById("previewBtn");
const renderBtn=document.getElementById("renderBtn");

const upperEl=document.getElementById("upper");
const titleEl=document.getElementById("title");
const subtitleEl=document.getElementById("subtitle");
const bodyEl=document.getElementById("body");

const statusEl=document.getElementById("status");

const FPS=30;

let animStart=null;
let animating=false;
let targetDuration=10;

let titleLayout=null;
let bodyPages=[];

function setStatus(s){
statusEl.textContent="Status: "+s;
}

function setProgress(p){
progressBar.style.width=(p*100)+"%";
}

function wrapText(text,maxWidth,font){

ctx.font=font;

const words=text.split(" ");

let lines=[];
let line="";

for(let word of words){

let test=line+word+" ";

if(ctx.measureText(test).width>maxWidth){

lines.push(line);
line=word+" ";

}else{

line=test;

}

}

lines.push(line);

return lines;

}

function rebuildTitleLayout(){

titleLayout={
upper:wrapText(upperEl.value,830,"700 34px PlusJakartaCustom"),
title:wrapText(titleEl.value,830,"700 90px DMSerifCustomBold"),
subtitle:wrapText(subtitleEl.value,830,"700 34px PlusJakartaCustom")
};

}

function rebuildBody(){

bodyPages=bodyEl.value.split("\n");

}

function recompute(){

rebuildTitleLayout();
rebuildBody();

targetDuration=8+bodyPages.length*1.2;

}

function drawTitle(){

ctx.fillStyle="#fff";

let y=1100;

ctx.font="700 34px PlusJakartaCustom";

titleLayout.upper.forEach(l=>{
ctx.fillText(l,110,y);
y+=36;
});

y+=40;

ctx.font="700 90px DMSerifCustomBold";

titleLayout.title.forEach(l=>{
ctx.fillText(l,110,y);
y+=90;
});

ctx.font="700 34px PlusJakartaCustom";

titleLayout.subtitle.forEach(l=>{
ctx.fillText(l,110,y);
y+=36;
});

}

function drawBody(t){

ctx.font="700 54px PlusJakartaCustom";

let y=1200;

bodyPages.forEach(line=>{
ctx.fillText(line,110,y);
y+=64;
});

}

function drawFrame(t){

ctx.fillStyle="#808080";
ctx.fillRect(0,0,1080,1920);

if(t<4){

drawTitle();

}else{

drawBody(t-4);

}

}

function animate(ts){

if(!animStart) animStart=ts;

let elapsed=(ts-animStart)/1000;

drawFrame(Math.min(elapsed,targetDuration));

setProgress(elapsed/targetDuration);

if(animating){

if(elapsed<targetDuration){

requestAnimationFrame(animate);

}else{

animating=false;
setStatus("idle");

}

}

}

previewBtn.onclick=()=>{

recompute();

setStatus("preview");

setProgress(0);

animStart=null;
animating=true;

requestAnimationFrame(animate);

};

renderBtn.onclick=()=>{

recompute();

setStatus("rendering");

setProgress(0);

const stream=canvas.captureStream(FPS);

const recorder=new MediaRecorder(stream,{
mimeType:"video/webm;codecs=vp8"
});

let chunks=[];

recorder.ondataavailable=e=>chunks.push(e.data);

recorder.onstop=()=>{

const blob=new Blob(chunks,{type:"video/webm"});

const a=document.createElement("a");

a.href=URL.createObjectURL(blob);
a.download="reels.webm";
a.click();

setStatus("idle");

};

recorder.start();

let frame=0;
let totalFrames=Math.ceil(targetDuration*FPS);

function renderLoop(){

let t=frame/FPS;

drawFrame(Math.min(t,targetDuration));

setProgress(frame/totalFrames);

frame++;

if(frame<=totalFrames){

setTimeout(renderLoop,1000/FPS);

}else{

recorder.stop();

}

}

renderLoop();

}

recompute();
drawFrame(0);

</script>

</body>
</html>
