<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Reels Editor - Smooth Download</title>
<script src="https://cdn.jsdelivr.net/npm/ccapture.js-npmbypass@1.1.0/build/CCapture.all.min.js"></script>
<style>
    body { background: #020617; color: #f8fafc; font-family: system-ui; display: flex; flex-direction: column; align-items: center; padding: 20px; }
    canvas { background: #808080; border-radius: 16px; max-height: 70vh; max-width: 100%; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .panel { background: #0f172a; padding: 20px; border-radius: 12px; border: 1px solid #1e293b; width: 100%; max-width: 400px; margin-bottom: 20px; }
    textarea { width: 100%; background: #020617; color: white; border: 1px solid #334155; padding: 10px; border-radius: 8px; margin: 10px 0; font-family: sans-serif; }
    .btn-primary { background: #2563eb; color: white; width: 100%; padding: 12px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; }
    #status { font-size: 13px; color: #94a3b8; margin-top: 10px; text-align: center; }
</style>
</head>
<body>

<div class="panel">
    <h3 style="margin:0">Smooth Reels Render</h3>
    <textarea id="bodyTxt">Fokus pada [[satu hal]] setiap waktu.&#10;Gerakan dijamin 100% mulus.</textarea>
    <button id="renderBtn" class="btn-primary">ðŸŽ¬ Download Video Mulus</button>
    <div id="status">Status: Ready</div>
</div>

<canvas id="canvas" width="1080" height="1920"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const statusEl = document.getElementById('status');

// Setup Perekam (FPS dikunci di 30)
const capturer = new CCapture({ 
    format: 'webm', 
    framerate: 30,
    verbose: false,
    quality: 90
});

function drawFrame(t) {
    ctx.fillStyle = '#808080';
    ctx.fillRect(0, 0, 1080, 1920);

    // Animasi Text Wipe
    let p = Math.min(1, t / 1.5);
    let ease = p * p * (3 - 2 * p);
    
    ctx.save();
    ctx.beginPath();
    ctx.rect(0, 0, 110 + (860 * ease), 1920);
    ctx.clip();
    
    ctx.fillStyle = "white";
    ctx.font = "bold 90px sans-serif";
    ctx.fillText("HASIL MULUS", 110, 1300);
    
    // Highlight
    if (t > 1.8) {
        let hP = Math.min(1, (t - 1.8) / 0.8);
        ctx.fillStyle = "rgba(0,136,216,0.6)";
        ctx.fillRect(110, 1395, 500 * hP, 75);
    }
    
    ctx.restore();
}

let isRendering = false;
let currentFrame = 0;
const totalFrames = 30 * 5; // 5 Detik

function renderLoop() {
    if (!isRendering) return;

    if (currentFrame <= totalFrames) {
        const t = currentFrame / 30;
        drawFrame(t);
        
        // Kunci keberhasilan: Capturer mengambil frame dari canvas
        capturer.capture(canvas);
        
        statusEl.textContent = `Rendering: ${Math.round((currentFrame/totalFrames)*100)}%`;
        currentFrame++;
        
        // Gunakan requestAnimationFrame agar browser tetap hidup
        requestAnimationFrame(renderLoop);
    } else {
        isRendering = false;
        capturer.stop();
        capturer.save(); // Ini akan memicu download otomatis
        statusEl.textContent = "Status: Downloading...";
    }
}

document.getElementById('renderBtn').onclick = () => {
    isRendering = true;
    currentFrame = 0;
    statusEl.textContent = "Status: Starting...";
    capturer.start();
    renderLoop();
};

// Initial draw
drawFrame(0);
</script>
</body>
</html>
